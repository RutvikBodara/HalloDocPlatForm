@model HalloDoc.DAL.ViewModals.Access.Rolemenucombine;
<div class="container-fluid mt-lg-5 mt-sm-3 mb-5">
    <!-- backbtn -->
    <div class="d-flex justify-content-center">
        <div class=" col-lg-8 col-md-8 col-sm-12 col-12 d-flex justify-content-between mb-3 mt-3">
            <div class="h3">Edit Role</div>
            <button class="btn btn-outline-primary" id="CreateAccessBack">
                <img src="/images/arrow_back_ios_FILL0_wght400_GRAD0_opsz24.svg" alt="" />
                back
            </button>
        </div>

    </div>
    <!-- form for submit -->
    <div class="d-flex justify-content-center">
        <div class=" col-lg-8 col-md-8 col-sm-12 col-12 shadow  p-3"
             style="border-radius: 10px">
            <div class="d-flex justify-content-start mb-2">
                <h4> Details</h4>
            </div>
            <form id="EditAccessForm">
                <div class="row">
                    <div class="col-12 col-md-6">
                        <div class="form-floating mb-4">
                            <input asp-for="Role.Name" type="text" class="form-control" id="RoleName" placeholder=" RoleName" />
                            <label for="RoleName">RoleName</label>
                            <span asp-validation-for="Role" style="color:indianred"></span>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="form-floating mb-4">
                            <select class="form-select" id="Changeaccount">
                                @* <option value="@Model.Role.AccounttypeNavigation.AccountTypeId" selected disabled>Select Account Type</option> *@
                                @foreach (var obj in Model.accounttype)
                                {
                                    if (obj.AccountTypeId == Model.Role.Accounttype)
                                    {
                                        <option value="@obj.AccountTypeId" selected>@obj.Name</option>
                                    }
                                    else
                                    {
                                        <option value="@obj.AccountTypeId">@obj.Name</option>
                                    }
                                }
                            </select>
                            <label for="floatingInputstate">State</label>
                        </div>
                    </div>
                </div>
                <div id="LoadRoleMenu">
                </div>
                <div class="d-flex justify-content-end mt-3">
                    <button class="btn btn-primary p-3 me-4" id="CreateAccess" type="submit">Save</button>
                    <button class="btn btn-outline-primary p-3 me-4" id="canceledit" onclick="EditAccess(@Model.Role.Roleid)">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>

    $("#CreateAccessBack").click(function () {
        $("#Account-access-drop-down").click();
    });
    $("#canceledit").click(function (e) {
        e.preventDefault();
    })
    $("#Changeaccount").on("change", function () {
        $.ajax({
            url: '/AdminPartials/getAccountRoleMenu',
            method: 'POST',
            data: { accountType: $(this).val() },
            success: function (response) {
                $("#LoadRoleMenu").empty();
                response.forEach(function (item) {
                    $("#LoadRoleMenu").append('<input class="regioncheck" id="' + item.menuid + '" type = "checkbox" value = "' + item.menuid + '"  >  <label class="form-check-label me-3" for="' + item.menuid + '">' + item.name + '   </label > ');
                });
            }
        });
    });
    $("#EditAccessForm").on("submit", function (e) {
        e.preventDefault();
        var ids = [];
        var formdata = new FormData();
        formdata.append("Rolename", $("#RoleName").val());
        formdata.append("accounttype", $("#Changeaccount").val());
        $('input[type=checkbox]:checked').each(function () {
            // ids.push({ id: $(this).val()})
            formdata.append("arrayPage", $(this).attr("id"));
        });
        // $("#EditAccessForm").validate();
        // if ($("#EditAccessForm").valid()) {
        $.ajax({
            url: '/AdminPartials/EditAccessSubmit',
            method: 'POST',
            data: formdata,
            processData: false,
            contentType: false,
            success: function (response) {
                if (response == 1) {
                    toastr.success("Access Updated");
                    //only in case of change access type
                    //one more : reload only if edit role type is same as access account
                    window.location.reload();
                }
                else if (response == 2) {
                    toastr.success("Access Updated");
                }
                else {
                    //response=3
                    toastr.error("Something Went Wrong");
                }
                $("#canceledit").click();
            }
        });
        // }
    });

    // function CancelRole() {
    //     $(".admin-data-container").load('/AdminPartials/CreateAccess', function () {
    //         $.ajax({
    //             url: '/AdminPartials/getAccountRoleMenu',
    //             method: 'POST',
    //             success: function (response) {
    //                 console.log(response);
    //                 $("#LoadRoleMenu").empty();
    //                 response.forEach(function (item) {
    //                     $("#LoadRoleMenu").append('<input class="Accesscheck" id="' + item.menuid + '" type = "checkbox" value = "' + item.name + '"  >  <label class="form-check-label me-3" for="' + item.menuid + '">' + item.name + '   </label > ');
    //                 });
    //             }
    //         });
    //     })
    // }
</script>